> MySQLä¸­çš„å¤‡ä»½ä¸æ¢å¤æ˜¯æ•°æ®åº“ç®¡ç†ä¸­éå¸¸é‡è¦çš„éƒ¨åˆ†ã€‚å¤‡ä»½ç¡®ä¿äº†æ•°æ®åœ¨å‘ç”Ÿç¡¬ä»¶æ•…éšœã€è½¯ä»¶é”™è¯¯æˆ–äººä¸ºæ“ä½œå¤±è¯¯æ—¶å¯ä»¥å¾—åˆ°æ¢å¤ï¼Œä»è€Œä¿éšœç³»ç»Ÿçš„å¯é æ€§å’Œå¯ç”¨æ€§ã€‚ä¸‹é¢æ˜¯å…³äºMySQLå¤‡ä»½ä¸æ¢å¤çš„å…¨é¢æŒ‡å—ã€‚ğŸ 

<iframe allow="autoplay *; encrypted-media *;" frameborder="0" height="150" style="width:100%;max-width:880px;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="https://embed.music.apple.com/cn/album/%E5%83%8F%E9%B1%BC/1476388060?i=1476388063"></iframe>

![](https://photohosting.oss-cn-hangzhou.aliyuncs.com/notionCover/93d0e3f2c985449094377e89667f4c19.jpeg)

## MySQL å¤‡ä»½ä¸æ¢å¤

### 1. å¤‡ä»½ç­–ç•¥

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¤‡ä»½ç­–ç•¥åº”åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

#### 1.1 å®Œå…¨å¤‡ä»½
å®Œå…¨å¤‡ä»½æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“çš„ä¸€ä¸ªå®Œæ•´æ‹·è´ï¼Œé€šå¸¸å®šæœŸï¼ˆå¦‚æ¯å¤©ã€æ¯å‘¨ï¼‰è¿›è¡Œã€‚

#### 1.2 å¢é‡å¤‡ä»½
å¢é‡å¤‡ä»½åªå¤‡ä»½è‡ªä¸Šæ¬¡å®Œå…¨å¤‡ä»½ä»¥æ¥æ‰€åšçš„æ›´æ”¹ï¼Œå‡å°‘äº†å¤‡ä»½çš„æ•°æ®é‡å’Œæ—¶é—´ã€‚

#### 1.3 å·®å¼‚å¤‡ä»½
å·®å¼‚å¤‡ä»½å¤‡ä»½è‡ªä¸Šæ¬¡å®Œå…¨å¤‡ä»½ä»¥æ¥æ‰€æœ‰æ›´æ”¹çš„æ•°æ®ï¼Œè€Œä¸è€ƒè™‘è‡ªä¸Šæ¬¡å¢é‡å¤‡ä»½ä»¥æ¥çš„æ›´æ”¹ã€‚

### 2. å¤‡ä»½å·¥å…·

#### 2.1 ä½¿ç”¨ `mysqldump` å·¥å…·

`mysqldump` æ˜¯ MySQL è‡ªå¸¦çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç”Ÿæˆæ•°æ®åº“çš„é€»è¾‘å¤‡ä»½ã€‚

##### 2.1.1 å®Œå…¨å¤‡ä»½ç¤ºä¾‹

```shell
mysqldump -u root -p --all-databases > alldb_backup.sql
```

##### 2.1.2 å•ä¸ªæ•°æ®åº“å¤‡ä»½ç¤ºä¾‹

```shell
mysqldump -u root -p mydatabase > mydatabase_backup.sql
```

##### 2.1.3 å•ä¸ªè¡¨å¤‡ä»½ç¤ºä¾‹

```shell
mysqldump -u root -p mydatabase mytable > mytable_backup.sql
```

#### 2.2 ä½¿ç”¨ `mysqlpump` å·¥å…·

`mysqlpump` æ˜¯ MySQL 5.7 å¼•å…¥çš„ä¸€ä¸ªå¹¶å‘å¤‡ä»½å·¥å…·ï¼Œå…·æœ‰æ›´é«˜çš„æ€§èƒ½ã€‚

##### 2.2.1 å®Œå…¨å¤‡ä»½ç¤ºä¾‹

```shell
mysqlpump -u root -p --all-databases > alldb_backup_pump.sql
```

##### 2.2.2 å•ä¸ªæ•°æ®åº“å¤‡ä»½ç¤ºä¾‹

```shell
mysqlpump -u root -p mydatabase > mydatabase_backup_pump.sql
```

#### 2.3 ä½¿ç”¨ç‰©ç†å¤‡ä»½å·¥å…· `Percona XtraBackup`

`Percona XtraBackup` æ˜¯ä¸€ä¸ªå¼€æºçš„çƒ­å¤‡ä»½å·¥å…·ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®åº“ã€‚

##### 2.3.1 å®‰è£… Percona XtraBackup

```shell
sudo apt-get install percona-xtrabackup
```

##### 2.3.2 åˆ›å»ºå¤‡ä»½

```shell
xtrabackup --backup --target-dir=/path/to/backup --user=root --password=YOUR_PASSWORD
```

##### 2.3.3 å‡†å¤‡å¤‡ä»½

```shell
xtrabackup --prepare --target-dir=/path/to/backup
```

### 3. æ¢å¤æ•°æ®

#### 3.1 ä½¿ç”¨ `mysqldump` å¤‡ä»½æ–‡ä»¶æ¢å¤

##### 3.1.1 æ¢å¤å•ä¸ªæ•°æ®åº“

```shell
mysql -u root -p mydatabase < mydatabase_backup.sql
```

##### 3.1.2 æ¢å¤æ‰€æœ‰æ•°æ®åº“

```shell
mysql -u root -p < alldb_backup.sql
```

#### 3.2 ä½¿ç”¨ `mysqlpump` å¤‡ä»½æ–‡ä»¶æ¢å¤

```shell
mysql -u root -p < alldb_backup_pump.sql
```

#### 3.3 ä½¿ç”¨ `Percona XtraBackup` æ¢å¤

##### 3.3.1 åœæ­¢ MySQL æœåŠ¡

```shell
sudo systemctl stop mysql
```

##### 3.3.2 è§£å‹å¤‡ä»½

```shell
xtrabackup --copy-back --target-dir=/path/to/backup
```

##### 3.3.3 ä¿®æ­£æƒé™

```shell
sudo chown -R mysql:mysql /var/lib/mysql
```

##### 3.3.4 å¯åŠ¨ MySQL æœåŠ¡

```shell
sudo systemctl start mysql
```

### 4. è‡ªåŠ¨åŒ–å¤‡ä»½ä¸æ¢å¤

ä½¿ç”¨è„šæœ¬è‡ªåŠ¨åŒ–å¤‡ä»½è¿‡ç¨‹å¯ä»¥æé«˜æ•ˆç‡ï¼Œé™ä½äººä¸ºé”™è¯¯çš„é£é™©ã€‚

#### 4.1 è‡ªåŠ¨åŒ–å¤‡ä»½è„šæœ¬

```bash
#!/bin/bash

# é…ç½®
BACKUP_DIR="/path/to/backup"
MYSQL_USER="root"
MYSQL_PASSWORD="YOUR_PASSWORD"
DATE=$(date +%Y-%m-%d_%H-%M-%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# æ‰§è¡Œå¤‡ä»½
mysqldump -u $MYSQL_USER -p$MYSQL_PASSWORD --all-databases > $BACKUP_DIR/alldb_backup_$DATE.sql

# åˆ é™¤è¶…è¿‡30å¤©çš„å¤‡ä»½
find $BACKUP_DIR -type f -mtime +30 -delete
```

#### 4.2 ä½¿ç”¨ `crontab` å®šæ—¶æ‰§è¡Œå¤‡ä»½è„šæœ¬

ç¼–è¾‘ `crontab` é…ç½®æ–‡ä»¶ï¼š

```shell
crontab -e
```

æ·»åŠ ä»¥ä¸‹è¡Œï¼Œæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå¤‡ä»½ï¼š

```plaintext
0 2 * * * /path/to/your/backup_script.sh
```

### 5. å¤‡ä»½ä¸æ¢å¤æœ€ä½³å®è·µ

- **å®šæœŸæµ‹è¯•å¤‡ä»½**ï¼šå®šæœŸæµ‹è¯•æ¢å¤è¿‡ç¨‹ï¼Œä»¥ç¡®ä¿å¤‡ä»½æ–‡ä»¶æœ‰æ•ˆã€‚
- **å¤šåœ°å­˜å‚¨å¤‡ä»½**ï¼šå°†å¤‡ä»½å­˜å‚¨åœ¨ä¸åŒçš„åœ°ç†ä½ç½®ï¼Œé˜²æ­¢ç¾éš¾å‘ç”Ÿã€‚
- **åŠ å¯†å¤‡ä»½æ–‡ä»¶**ï¼šç¡®ä¿å¤‡ä»½æ–‡ä»¶çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æœªç»æˆæƒçš„è®¿é—®ã€‚
- **è®°å½•å¤‡ä»½æ—¥å¿—**ï¼šè¯¦ç»†è®°å½•æ¯æ¬¡å¤‡ä»½å’Œæ¢å¤æ“ä½œï¼Œä»¥ä¾¿è·Ÿè¸ªå’Œå®¡æ ¸ã€‚

ä»¥ä¸Šæ˜¯å…³äºMySQLå¤‡ä»½ä¸æ¢å¤çš„å…¨é¢æŒ‡å—ã€‚é€šè¿‡è¿™äº›æ–¹æ³•å’Œå·¥å…·ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°ä¿æŠ¤ä½ çš„æ•°æ®ï¼Œå¹¶åœ¨éœ€è¦æ—¶è¿…é€Ÿæ¢å¤ç³»ç»Ÿã€‚å¦‚æœæœ‰ä»»ä½•è¿›ä¸€æ­¥çš„é—®é¢˜æˆ–éœ€è¦æ›´å¤šçš„ç»†èŠ‚ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼

## é¡¹ç›®å®è·µ

> åœ¨ C++ ä¸­è¿›è¡Œ MySQL å¤‡ä»½ä¸æ¢å¤æ“ä½œï¼Œä½ å¯ä»¥ä½¿ç”¨ MySQL æä¾›çš„ C APIï¼Œä¹Ÿå°±æ˜¯ `mysql.h` å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°æ¥å®ç°ã€‚ä¸‹é¢æˆ‘å°†ç»™ä½ ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨ C++ ä¸­ä½¿ç”¨ MySQL C API è¿›è¡Œå¤‡ä»½å’Œæ¢å¤æ“ä½œã€‚

### MySQL è¿æ¥

é¦–å…ˆï¼Œä½ éœ€è¦ç¡®ä¿å·²ç»å®‰è£…äº† MySQL C API çš„å¼€å‘åº“ï¼Œå¹¶ä¸”æ­£ç¡®é…ç½®äº†å¼€å‘ç¯å¢ƒã€‚æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥è¿æ¥åˆ° MySQL æ•°æ®åº“ï¼š

```cpp
#include <mysql.h>
#include <iostream>

int main() {
    MYSQL *conn;
    conn = mysql_init(nullptr);
    
    if (conn == nullptr) {
        std::cerr << "Error: " << mysql_error(conn) << std::endl;
        return 1;
    }
    
    if (!mysql_real_connect(conn, "localhost", "username", "password", "databasename", 0, nullptr, 0)) {
        std::cerr << "Error: " << mysql_error(conn) << std::endl;
        return 1;
    }

    // è¿æ¥æˆåŠŸ
    std::cout << "è¿æ¥åˆ°æ•°æ®åº“æˆåŠŸ" << std::endl;

    // åœ¨è¿™é‡Œæ‰§è¡Œå¤‡ä»½æˆ–æ¢å¤æ“ä½œ

    mysql_close(conn);
    return 0;
}
```

### æ•°æ®åº“å¤‡ä»½

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œç”¨äºæ‰§è¡Œæ•°æ®åº“å¤‡ä»½æ“ä½œï¼Œå¹¶å°†å¤‡ä»½ç»“æœå†™å…¥åˆ°æ–‡ä»¶ä¸­ï¼š

```cpp
// æ‰§è¡Œæ•°æ®åº“å¤‡ä»½æ“ä½œ
if (mysql_query(conn, "BACKUP DATABASE databasename TO 'backupfile.sql'")) {
    std::cerr << "å¤‡ä»½å¤±è´¥: " << mysql_error(conn) << std::endl;
} else {
    std::cout << "æ•°æ®åº“å¤‡ä»½æˆåŠŸ" << std::endl;
}
```

### æ•°æ®åº“æ¢å¤

ç±»ä¼¼åœ°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œç”¨äºæ‰§è¡Œæ•°æ®åº“æ¢å¤æ“ä½œï¼Œä»æŒ‡å®šçš„å¤‡ä»½æ–‡ä»¶ä¸­æ¢å¤æ•°æ®åº“ï¼š

```cpp
// æ‰§è¡Œæ•°æ®åº“æ¢å¤æ“ä½œ
if (mysql_query(conn, "RESTORE DATABASE databasename FROM 'backupfile.sql'")) {
    std::cerr << "æ¢å¤å¤±è´¥: " << mysql_error(conn) << std::endl;
} else {
    std::cout << "æ•°æ®åº“æ¢å¤æˆåŠŸ" << std::endl;
}
```

è¯·æ³¨æ„ï¼Œä»¥ä¸Šä»£ç ä»…ä½œä¸ºç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­è¿˜éœ€è¦è€ƒè™‘æ›´å¤šçš„é”™è¯¯å¤„ç†ã€æ—¥å¿—è®°å½•ç­‰æ–¹é¢ã€‚æ­¤å¤–ï¼Œä½ éœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹è¿æ¥å‚æ•°ã€å¤‡ä»½æ–‡ä»¶è·¯å¾„ç­‰ä¿¡æ¯ã€‚

---

